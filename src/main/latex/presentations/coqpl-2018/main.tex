\documentclass[pdf]{beamer}
\usepackage{listings}
\usepackage{adjustbox}
\input{theme.tex}
\input{definitions.tex}

\title[Coqatoo]{\includegraphics[width=50pt]{images/logo.png}\\Coqatoo}
\subtitle{Generating Natural Language Versions of Coq Proofs}
\author{Andrew Bedford}
\institute{Laval University}
\date{CoqPL 2018}
\expandafter\def\expandafter\insertshorttitle\expandafter{%
\insertshorttitle\hfill%
\insertframenumber\,/\,\inserttotalframenumber}
\begin{document}

\begin{frame}
    \titlepage
\end{frame}

\begin{frame}{Motivation}
    \begin{itemize}
        \item Proofs can sometimes be hard to understand, particularly for less-experienced users
    \end{itemize}
\end{frame}

\begin{frame}[fragile]{Example}{Input}
\begin{adjustbox}{minipage=\linewidth,bgcolor=coqatoo-gray,trim=-3pt 5pt -3pt 5pt}        
\begin{lstlisting}[label=listing:input]
Lemma conj_imp_equiv : forall P Q R:Prop, (P /\ Q -> R) <-> (P -> Q -> R).
Proof.
  intros. split. intros H HP HQ. apply H. apply conj. assumption. assumption. intros H HPQ. inversion HPQ. apply H. assumption. assumption.
Qed.
\end{lstlisting}
\end{adjustbox}
\end{frame}

\begin{frame}[fragile]{Previous Work}{CtCoq and PCoq}
CtCoq and its successor Pcoq are no longer available
\begin{adjustbox}{minipage=\linewidth,bgcolor=coqatoo-gray,trim=-3pt 5pt -3pt 5pt}            
\begin{lstlisting}
conj_imp_equiv = 
fun P Q R : Prop =>
conj (fun (H : P /\ Q -> R) (HP : P) (HQ : Q) => H (conj HP HQ))
    (fun (H : P -> Q -> R) (HPQ : P /\ Q) =>
    let H0 :=
        match HPQ with
        | conj H0 H1 => (fun (H2 : P) (H3 : Q) => H H2 H3) H0 H1
        end
        :
        R in
    H0)
        : forall P Q R : Prop, (P /\ Q -> R) <-> (P -> Q -> R)
\end{lstlisting}
\end{adjustbox}
\end{frame}

\begin{frame}{Previous Work}{Disadvantages}
\begin{itemize}
    \item Verbosity
\end{itemize}
\end{frame}

\begin{frame}{Coqatoo}
Different approach
\end{frame}

\begin{frame}{Overview of Coqatoo}
    Coqatoo's rewriting algorithm can be decomposed in three steps:
    \begin{enumerate}
        \item Information extraction
        \item Proof tree construction
        \item Tactic-based rewriting
    \end{enumerate}
\end{frame}


\begin{frame}[fragile]{Step 1: Information extraction}
Coqatoo captures the intermediary proof states
\begin{adjustbox}{minipage=\linewidth,bgcolor=coqatoo-gray,trim=-3pt 5pt -3pt 5pt}
\begin{lstlisting}[label=listing:before-intros]
1 subgoal

============================
forall P Q R : Prop, (P /\ Q -> R) <-> (P -> Q -> R)
\end{lstlisting}
\end{adjustbox}
~\\~\\
\begin{adjustbox}{minipage=\linewidth,bgcolor=coqatoo-gray,trim=-3pt 5pt -3pt 5pt}
\begin{lstlisting}[label=listing:after-intros]
1 subgoal

P, Q, R : Prop
============================
(P /\ Q -> R) <-> (P -> Q -> R)
\end{lstlisting}
\end{adjustbox}
\end{frame}

\begin{frame}{Step 2: Proof tree construction}
    \vspace{-13pt}\center\includegraphics[height=0.85\textheight]{images/proof-tree.png}
\end{frame}

\begin{frame}{Step 3: Tactic-based rewriting}

\end{frame}

\begin{frame}{Example}{Output Modes}
\end{frame}

\begin{frame}{Example}{Output (--mode plain)}
\end{frame}

\begin{frame}[fragile]{Example}{Output (--mode annotated)}
\begin{adjustbox}{minipage=\linewidth,bgcolor=coqatoo-gray,trim=-3pt 5pt -3pt 5pt}
\begin{lstlisting}[label=listing:output]
Lemma conj_imp_equiv : forall P Q R:Prop, (P /\ Q -> R) <-> (P -> Q -> R).
Proof.
  (* Given any P, Q, R : Prop. Let us show that (P /\ Q -> R) <-> (P -> Q -> R) is true. *) intros.
  split.
  - (* Case (P /\ Q -> R) -> P -> Q -> R: *) 
    (* Suppose that P, Q and P /\ Q -> R are true. Let us show that R is true. *) intros H HP HQ.
    (* By our hypothesis P /\ Q -> R, we know that R is true if P /\ Q  is true. *) apply H.
    apply conj.
    -- (* Case P: *)
       (* True, because it is one of our assumptions. *) assumption.
    -- (* Case Q: *)
       (* True, because it is one of our assumptions. *) assumption.
  - (* Case (P -> Q -> R) -> P /\ Q -> R: *)
    (* Suppose that P /\ Q and P -> Q -> R are true. Let us show that R is true. *) intros H HPQ.
    (* By inversion on P /\ Q, we know that P, Q are also true. *) inversion HPQ.
    (* By our hypothesis P -> Q -> R, we know that R is true if P and Q are true. *) apply H.
    -- (* Case P: *)
       (* True, because it is one of our assumptions. *) assumption.
    -- (* Case Q: *)
       (* True, because it is one of our assumptions. *) assumption.
Qed.
\end{lstlisting}
\end{adjustbox}
\end{frame}

\begin{frame}{Example}{Output (--mode latex)}
    \begin{lemma} (conj\_imp\_equiv) $\forall P, Q, R : Prop, (P \land Q \Rightarrow R) \Leftrightarrow (P \Rightarrow Q \Rightarrow R)$
    \end{lemma}
    \begin{proof}
        Given any $P, Q, R : Prop$. Let us show that $(P \land Q \Rightarrow R) \Leftrightarrow (P \Rightarrow Q \Rightarrow R)$ is true.
        %Must define new environements for the case and subcases
    \end{proof}
\end{frame}

\begin{frame}
    \Huge \center Demonstration
\end{frame}

\begin{frame}{Comparison}{Disadvantages}
    \begin{itemize}
        \item{It only works on proofs whose tactics are supported, while the approach of Coscoy et al. worked on any proof.}
        \item{It may require additional verifications to ensure that unecessary information (e.g., an assertion which isn't used) is not included in the generated proof.}
    \end{itemize}
\end{frame}

\begin{frame}{Comparison}{Advantages}
    \begin{itemize}
        \item{It enables us to more easily control the size and verbosity of the generated proof (one or two sentences per tactic by default).}
        \item{It maintains the order and structure of the user's original proof script; this is not necessarily the case in Coscoy et al. }
      \end{itemize}
\end{frame}

\begin{frame}{Future work}
    \begin{itemize}
        \item Increase the number of supported tactics
        \begin{itemize}
            \item Goal: Software Foundations
        \end{itemize}
        \item Add partial support for automation
        \item Integration with existing development environments
        \item Add a LaTeX output mode
    \end{itemize}
\end{frame}

\end{document}